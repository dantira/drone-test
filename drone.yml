name: drone-test
kind: pipeline
type: docker

steps:
- name: testvar
  image: alpine:3.8
  environment:
    SSH_KEY:
      from_secret: ansible_private_key
  commands:
      - echo "$SSH_KEY"

- name: test
  image: plugins/ansible:3.0
  environment:
    SSH_KEY:
      from_secret: ansible_private_key
  commands:
    - echo -e $SSH_KEY > /id_rsa
  settings:
    playbook: .ansible/playbook.yml
    inventory: .ansible/inventory.yml
    become: true
    ssh_extra_args: "-o StrictHostKeyChecking=no"
    extra_vars:
      from_secret: ANSIBLE_EXTRA_VARS
    private_key:
      from_secret: ansible_private_key


